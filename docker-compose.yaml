version: "3.7"
x-tfx-service: &tfx-service
  build:
    context: .
    dockerfile: ./docker/Dockerfile
  environment:
    AIRFLOW_HOME: ~/airflow
    TFX_DIR: ~/tfx
    CIFAR10_DIR: ~/cifar10
  volumes: 
    - ./cifar10:/root/cifar10
  restart: always
services:
  server:
    <<: *tfx-service
    ports:
      - "8080:8080"
    #environment:
    #  AIRFLOW_HOME: ~/airflow
    #  TFX_DIR: ~/tfx
    #  CIFAR10_DIR: ~/cifar10
    #volumes: 
    #  - ./cifar10:/root/cifar10
    command: ["airflow", "webserver"]
  scheduler:
    <<: *tfx-service
    command: ["airflow", "scheduler"]
networks:
  default:
    driver: bridge
