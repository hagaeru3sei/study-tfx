version: "3.7"
x-tfx-service: &tfx-service
  build:
    context: .
    dockerfile: ./docker/Dockerfile
  environment:
    AIRFLOW_HOME: ~/airflow
    TFX_DIR: ~/tfx
    CIFAR10_DIR: ~/cifar10
  volumes:
    - ./dags:/root/airflow/dags
    - ./cifar10:/root/cifar10
  restart: always
services:
  server:
    <<: *tfx-service
    ports:
      - "8080:8080"
    command: ["airflow", "webserver"]
  scheduler:
    <<: *tfx-service
    depends_on:
      - server
    command: ["airflow", "scheduler"]
networks:
  default:
    driver: bridge

